<%= form_for cart, url: {controller: 'carts', action: :update}, html: {class: 'form-horizontal'} do |f| %>
  <legend>
    Shipping Address
    <div class='pull-right'>
      <%= f.collection_select :address_id, Address.where(user_id: current_user.id).sort, :id, :street_address, options = { include_blank: "&mdash; new address &mdash;".html_safe, selected: (cart.address.id rescue nil) }, data: { remote: true, url: edit_cart_path(cart) } %>
    </div>
  </legend>
  <%= f.fields_for :address do |address_field| %>
    <%= render 'addresses/form', f: address_field %>
    <div class='control-group'>
      <div class='controls'>
        <label class='checkbox'>
          <%= address_field.check_box :default %> Set this address as default
        </label>
      </div>
    </div>
  <% end %>
<% end %>